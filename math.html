<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>수학 채점</title>
<style>
  :root{
    --bg: #f0f2f5;
    --card: #ffffff;
    --border: #e1e4e8;
    --text: #1a1a1a;
    --muted: #6b7280;

    /* 수학 포인트 */
    --primary: #4dabf7;
    --primary-ink: #1c7ed6;
    --primary-soft: #e7f3ff;
    --primary-soft-2: #f5fbff;

    --shadow-lg: 0 10px 30px rgba(0,0,0,0.08);
    --shadow-md: 0 4px 12px rgba(0,0,0,0.05);
    --shadow-sm: 0 6px 14px rgba(0,0,0,0.06);
  }

  * { box-sizing: border-box; }
  body{
    font-family: 'Apple SD Gothic Neo', sans-serif;
    background: var(--bg);
    margin: 0;
    min-height: 100vh;
    padding: 20px;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    color: var(--text);
  }

  .container{
    background: var(--card);
    width: 100%;
    max-width: 900px;
    padding: 30px;
    border-radius: 25px;
    box-shadow: var(--shadow-lg);
  }

  h2{
    margin: 0 0 14px 0;
    font-size: 22px;
    letter-spacing: -0.2px;
  }

  .subtext{
    margin: 0 0 18px 0;
    color: var(--muted);
    font-size: 14px;
    line-height: 1.4;
  }

  .hidden { display: none; }

  /* 세트 선택 영역 */
  .set-grid{
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 12px;
    margin-top: 10px;
  }
  @media (max-width: 820px){
    .set-grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
  }
  @media (max-width: 520px){
    .set-grid{ grid-template-columns: 1fr; }
  }

  .set-btn{
    appearance: none;
    background: var(--card);
    border: 2px solid var(--border);
    border-radius: 12px;
    padding: 14px 12px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease, background .15s ease;
    text-align: left;
  }
  .set-btn:hover{
    border-color: var(--primary);
    background: #eef6ff;
    transform: translateY(-2px);
    box-shadow: var(--shadow-sm);
  }
  .set-btn:active{
    transform: translateY(-1px);
  }

  /* 퀴즈 영역 헤더 */
  .quiz-head{
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 10px;
    margin-top: 22px;
    padding-top: 18px;
    border-top: 1px solid rgba(0,0,0,0.06);
  }
  #setTitle{
    margin: 0;
    font-size: 18px;
    font-weight: 800;
    letter-spacing: -0.2px;
  }
  .hint{
    margin: 0;
    color: var(--muted);
    font-size: 13px;
    line-height: 1.3;
    text-align: right;
    white-space: nowrap;
  }

  /* 문항 카드 */
  .question{
    background: var(--card);
    border: 2px solid var(--border);
    border-radius: 16px;
    padding: 16px;
    box-shadow: var(--shadow-md);
    margin: 14px 0;
  }

  .q-title{
    font-weight: 800;
    color: var(--text);
    margin-bottom: 12px;
    letter-spacing: -0.2px;
  }

  /* 2×4 선택지 그리드 */
  .choices{
    display: grid;
    grid-template-columns: repeat(4, minmax(0, 1fr));
    gap: 10px;
  }
  @media (max-width: 520px){
    .choices{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
  }

  /* 선택지 버튼 */
  label.choice{
    display: block;
    border: 2px solid var(--border);
    border-radius: 12px;
    background: var(--card);
    padding: 12px 8px;
    cursor: pointer;
    text-align: center;
    transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease, background .12s ease, color .12s ease;
    user-select: none;
  }
  label.choice:hover{
    border-color: var(--primary);
    background: var(--primary-soft-2);
    transform: translateY(-1px);
    box-shadow: 0 6px 14px rgba(0,0,0,0.06);
  }

  /* 모름(8) 살짝 구분(선택사항) */
  label.choice.is-unknown{
    background: #f8f9fa;
  }

  input[type="radio"]{ display: none; }

  /* 체크 상태 */
  input[type="radio"]:checked + span{
    display: block;
    background: var(--primary-soft);
    border-radius: 10px;
    color: var(--primary-ink);
    font-weight: 800;
    padding: 10px 6px;
  }
  /* 체크 상태에서 바깥 테두리도 포인트 */
  label.choice:has(input[type="radio"]:checked){
    border-color: var(--primary);
    background: var(--primary-soft-2);
    box-shadow: 0 8px 18px rgba(77,171,247,0.18);
  }

  /* 제출 버튼 */
  .actions{
    margin-top: 16px;
    display: flex;
    gap: 10px;
    align-items: center;
  }

  #submitBtn{
    appearance: none;
    border: none;
    border-radius: 12px;
    background: var(--primary);
    color: white;
    font-weight: 800;
    padding: 12px 16px;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(77,171,247,0.30);
    transition: transform .15s ease, filter .15s ease, box-shadow .15s ease, background .15s ease;
  }
  #submitBtn:hover{
    filter: brightness(0.97);
    transform: translateY(-2px);
    box-shadow: 0 8px 18px rgba(77,171,247,0.35);
  }
  #submitBtn:disabled{
    background: #cfd4da;
    cursor: not-allowed;
    box-shadow: none;
    transform: none;
    filter: none;
  }

  /* 안내/에러 박스 */
  .notice{
    margin-top: 12px;
    padding: 12px 14px;
    border-radius: 12px;
    border: 2px solid transparent;
    background: transparent;
    color: var(--muted);
    font-size: 14px;
    line-height: 1.35;
  }
  .notice.error{
    background: #fff5f5;
    border-color: #ffd6d6;
    color: #c92a2a;
  }

  /* 결과 카드 */
  #result{
    margin-top: 22px;
    padding: 20px;
    border-radius: 12px;
    border: 2px solid var(--border);
    background: #f8f9fa;
    font-weight: 800;
    line-height: 1.5;
  }
  #result.good{
    background: #f1fff3;
    border-color: #b2f2bb;
    color: #2b8a3e;
  }
  #result.bad{
    background: #fff5f5;
    border-color: #ffc9c9;
    color: #c92a2a;
  }
</style>
</head>

<body>
  <div class="container">
    <h2>수학 세트 선택</h2>
    <p class="subtext">세트를 선택하면 문항이 표시됩니다. 모든 문항은 반드시 1개씩 선택해야 제출할 수 있습니다. (모름도 선택 가능)</p>

    <div id="setSelect" class="set-grid"></div>

    <div id="quiz" class="hidden">
      <div class="quiz-head">
        <h3 id="setTitle"></h3>
        <p class="hint">2×4 선택지 · 세트 단위 제출</p>
      </div>

      <form id="quizForm"></form>

      <div class="actions">
        <button id="submitBtn" type="button">제출</button>
      </div>
      <div id="error" class="notice hidden"></div>
    </div>

    <div id="result" class="hidden"></div>
  </div>

<script src="./math_sets.js"></script>
<script>
const setSelect = document.getElementById("setSelect");
const quiz = document.getElementById("quiz");
const quizForm = document.getElementById("quizForm");
const submitBtn = document.getElementById("submitBtn");
const errorDiv = document.getElementById("error");
const resultDiv = document.getElementById("result");
const setTitle = document.getElementById("setTitle");

let currentSet = null;

// 세트 선택 UI
window.SET_BANK.forEach(set => {
  const btn = document.createElement("button");
  btn.type = "button";
  btn.textContent = set.title;
  btn.className = "set-btn";
  btn.onclick = () => loadSet(set);
  setSelect.appendChild(btn);
});

function showError(msg){
  errorDiv.textContent = msg;
  errorDiv.classList.remove("hidden");
  errorDiv.classList.add("error");
}

function clearError(){
  errorDiv.textContent = "";
  errorDiv.classList.add("hidden");
  errorDiv.classList.remove("error");
}

function loadSet(set) {
  currentSet = set;
  quizForm.innerHTML = "";
  resultDiv.classList.add("hidden");
  resultDiv.classList.remove("good","bad");
  resultDiv.textContent = "";
  clearError();
  quiz.classList.remove("hidden");
  setTitle.textContent = set.title;

  const attempts = Number(localStorage.getItem("math_attempts_" + set.id) || 0);
  if (attempts >= 5) {
    submitBtn.disabled = true;
    showError("제출 횟수를 초과했습니다");
  } else {
    submitBtn.disabled = false;
    clearError();
  }

  set.prompts.forEach((prompt, qi) => {
    const qDiv = document.createElement("div");
    qDiv.className = "question";

    const title = document.createElement("div");
    title.className = "q-title";
    title.textContent = `문항 ${qi + 1}`;
    qDiv.appendChild(title);

    const choicesDiv = document.createElement("div");
    choicesDiv.className = "choices";

    set.choices[qi].forEach((choice, ci) => {
      const label = document.createElement("label");
      label.className = "choice" + ((ci === 7) ? " is-unknown" : "");

      // 주의: 정답/해설/힌트 노출 금지 → choice 텍스트만 그대로 표시
      label.innerHTML = `
        <input type="radio" name="q${qi}" value="${ci + 1}">
        <span>${ci + 1}. ${choice}</span>
      `;
      choicesDiv.appendChild(label);
    });

    qDiv.appendChild(choicesDiv);
    quizForm.appendChild(qDiv);
  });
}

submitBtn.onclick = () => {
  if (!currentSet) return;

  const attemptsKey = "math_attempts_" + currentSet.id;
  const attempts = Number(localStorage.getItem(attemptsKey) || 0);

  if (attempts >= 5) {
    submitBtn.disabled = true;
    showError("제출 횟수를 초과했습니다");
    return;
  }

  clearError();

  const answers = [];
  for (let i = 0; i < currentSet.prompts.length; i++) {
    const checked = document.querySelector(`input[name="q${i}"]:checked`);
    if (!checked) {
      showError("모든 문항을 선택해야 제출할 수 있습니다");
      return; // 미선택 상태에서 제출(채점/카운트 증가) 금지
    }
    answers.push(Number(checked.value));
  }

  // 채점 실제 실행 시에만 카운트 증가
  localStorage.setItem(attemptsKey, attempts + 1);

  const wrong = [];
  answers.forEach((v, i) => {
    // “모름(8)”은 답(1~7)과 불일치 → 항상 오답 처리됨
    if (v !== currentSet.answers[i]) wrong.push(i + 1);
  });

  quiz.classList.add("hidden");
  resultDiv.classList.remove("hidden");
  resultDiv.classList.toggle("good", wrong.length === 0);
  resultDiv.classList.toggle("bad", wrong.length > 0);

  // 정책: 틀린 개수 + 틀린 문항 번호만 표시 (맞힌 개수/정답/해설 금지)
  resultDiv.textContent =
    `틀린 개수: ${wrong.length}\n틀린 문항 번호: ${wrong.join(", ") || "없음"}`;

  // 5회 도달 시 이후 재진입 시 막히도록(현재 화면은 결과만 보여주므로 별도 버튼은 없음)
};
</script>

</body>
</html>
